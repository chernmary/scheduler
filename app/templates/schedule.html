<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>График сотрудников</title>
  <link rel="stylesheet" href="/static/css/schedule.css" />
</head>
<body>

<header class="topbar">
  <nav class="nav-tabs">
    <a href="/schedule" class="nav-link">График</a>
    <a href="/admin/archive" class="nav-link">Архив</a>
    <a href="/employees" class="nav-link">Сотрудники</a>
  </nav>

  <div class="auth">
    {% if is_admin %}
      <form action="/logout" method="post">
        <button type="submit" class="btn-gradient small">Выйти</button>
      </form>
    {% else %}
      <form action="/login" method="post" class="login-form">
        <input type="text" name="username" placeholder="Логин" />
        <input type="password" name="password" placeholder="Пароль" />
        <button type="submit" class="btn-gradient small">Войти</button>
      </form>
    {% endif %}
  </div>
</header>

<h1 class="page-title">График сотрудников</h1>

<div class="table-wrapper">
  <form method="post">
    <input type="hidden" name="start_iso" value="{{ start_iso }}">

    <table class="schedule-table">
      <thead>
        <tr>
          <th class="location-col">Локация</th>
          {% for day in dates %}
            {% set i = loop.index0 %}
            {% set is_weekend = (i % 7) in [5, 6] %}
            <th class="date-header {% if is_weekend %}weekend{% endif %}">
              <span class="date-chip">{{ day }}</span>
            </th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        {% for loc_name, row in schedule.items() %}
          <tr>
            <td class="location-name">{{ loc_name }}</td>
            {% for cell in row %}
              {% set i = loop.index0 %}
              {% set is_weekend = (i % 7) in [5, 6] %}
              <td class="{% if is_weekend %}weekend{% endif %}">
                {% if is_admin %}
                  <select
                    name="decisions[{{ raw_dates[i] }}][{{ locations_map[loc_name] }}]"
                    {% if readonly %}disabled{% endif %}>
                    <option value="">—</option>
                    {% for emp in employees %}
                      <option value="{{ emp.id }}" {% if cell == emp.full_name %}selected{% endif %}>
                        {{ emp.full_name }}
                      </option>
                    {% endfor %}
                  </select>
                {% else %}
                  {{ cell }}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if is_admin %}
      <div class="button-container">
        {% if can_generate_next %}
          <button class="btn-gradient" formaction="/schedule/generate_next" formmethod="post">Сгенерировать</button>
        {% endif %}
        {% if is_preview %}
          <button class="btn-gradient" formaction="/schedule/save" formmethod="post">Опубликовать</button>
        {% else %}
          <button class="btn-gradient" formaction="/schedule/begin_edit" formmethod="post">Начать редактирование</button>
        {% endif %}
      </div>
    {% endif %}
  </form>
</div>

</body>
</html>
