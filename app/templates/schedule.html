{% extends "base.html" %}
{% block title %}График сотрудников{% endblock %}

{% block content %}
<h1 class="page-title">График сотрудников</h1>

<div class="table-wrapper">
  <form action="/schedule/save" method="post">
    <input type="hidden" name="start_iso" value="{{ start_iso }}">

    <table class="schedule-table">
      <thead>
        <tr>
          <th class="location-col">Локация</th>
          {% for date_str in dates %}
            {% set day_num = loop.index0 %}
            {% set is_weekend = day_num % 7 in [5, 6] %}
            <th class="date-header {% if is_weekend %}weekend{% endif %}">
              <span class="date-chip">{{ date_str }}</span>
            </th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        {% for loc, row in schedule.items() %}
          <tr>
            <td class="location-name">{{ loc }}</td>
            {% for val in row %}
              {% set day_num = loop.index0 %}
              {% set is_weekend = day_num % 7 in [5, 6] %}
              <td class="{% if is_weekend %}weekend{% endif %}">
                {% if is_admin %}
                  <select name="decisions[{{ raw_dates[day_num] }}][{{ locations_map[loc] }}]">
                    <option value="">—</option>
                    {% for emp in employees %}
                      <option value="{{ emp.id }}"
                        {% if emp.full_name == val %}selected{% endif %}>
                        {{ emp.full_name }}
                      </option>
                    {% endfor %}
                  </select>
                {% else %}
                  {{ val }}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if is_admin %}
    <div class="button-container">
      {% if can_generate_next %}
        <button type="submit" formaction="/schedule/generate_next" class="btn-gradient">Сгенерировать</button>
      {% endif %}
      {% if is_preview %}
        <button type="submit" class="btn-gradient">Опубликовать</button>
      {% else %}
        <button type="submit" formaction="/schedule/begin_edit" class="btn-gradient">Начать редактирование</button>
      {% endif %}
    </div>
    {% endif %}
  </form>
</div>
{% endblock %}
