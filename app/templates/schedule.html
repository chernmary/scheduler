{% extends "base.html" %}
{% block title %}График сотрудников{% endblock %}

{% block content %}
<div class="header">
  <div class="nav-tabs">
    <a href="/">График</a>
    <a href="/archive">Архив</a>
    <a href="/employees">Сотрудники</a>
  </div>

  {% if not request.session.get("user") %}
  <div class="login-container">
    <form action="/login" method="post">
      <input type="text" name="username" placeholder="Логин">
      <input type="password" name="password" placeholder="Пароль">
      <button type="submit">Войти</button>
    </form>
  </div>
  {% else %}
    <form action="/logout" method="post"><button type="submit">Выйти</button></form>
  {% endif %}
</div>

<h1>График сотрудников</h1>

<div class="table-wrapper">
  <form action="/schedule/save" method="post">
    <table>
      <thead>
        <tr>
          <th>Локация</th>
          {% for day in days %}
            <th>
              <!-- «Чип» делаем автоматически стилями -->
              <span class="date-chip">{{ day.date_str }} {{ day.weekday }}</span>
            </th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        {% for loc in locations %}
          <tr>
            <td>{{ loc.name }}</td>

            {% for day in days %}
              <td>
                <select
                  name="assignment[{{ day.iso }}][{{ loc.id }}]"
                  {% if not is_admin %}disabled{% endif %}>
                  <option value="">—</option>
                  {% for emp in employees_by_location[loc.id] %}
                    <option value="{{ emp.id }}"
                      {% if assignments[day.iso][loc.id] == emp.id %}selected{% endif %}>
                      {{ emp.short_name or emp.full_name }}
                    </option>
                  {% endfor %}
                </select>
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="button-container">
      {% if is_admin %}
        <button type="submit">Сохранить</button>
        <button type="submit" formaction="/schedule/generate">Сгенерировать</button>
      {% endif %}
    </div>
  </form>
</div>
{% endblock %}
