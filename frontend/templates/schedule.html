
<!DOCTYPE html>
<html>
<head>
    <title>–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</title>
    <style>
        body { font-family: sans-serif; }
        .grid { display: grid; grid-template-columns: repeat(15, 1fr); gap: 5px; }
        .cell { border: 1px solid #ccc; padding: 10px; min-height: 60px; background: #f9f9f9; }
        .employee { background: #def; margin: 2px; padding: 5px; cursor: move; }
        .droppable { background: #eee; }
    </style>
</head>
<body>
    <h1>–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</h1>
    <div id="schedule" class="grid"></div>
    <button onclick="exportExcel()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>

<script>
const employees = ["–ò–≤–∞–Ω–æ–≤", "–ü–µ—Ç—Ä–æ–≤", "–°–∏–¥–æ—Ä–æ–≤"];
const locations = ["–ó–∞–ª", "–ö—É—Ö–Ω—è", "–ë–∞—Ä"];
const days = Array.from({length: 14}, (_, i) => {
    const d = new Date();
    d.setDate(d.getDate() + i);
    return d.toLocaleDateString("ru-RU", { day: '2-digit', month: '2-digit', weekday: 'short' });
});

const container = document.getElementById("schedule");
container.innerHTML = "<div></div>" + days.map(d => "<div><b>" + d + "</b></div>").join("");

for (const loc of locations) {
    container.innerHTML += "<div><b>" + loc + "</b></div>";
    for (let i = 0; i < 14; i++) {
        const cell = document.createElement("div");
        cell.className = "cell droppable";
        cell.ondrop = drop;
        cell.ondragover = e => e.preventDefault();
        container.appendChild(cell);
    }
}

for (const emp of employees) {
    const eDiv = document.createElement("div");
    eDiv.textContent = emp;
    eDiv.className = "employee";
    eDiv.draggable = true;
    eDiv.ondragstart = e => e.dataTransfer.setData("text/plain", emp);
    document.body.appendChild(eDiv);
}

function drop(e) {
    const data = e.dataTransfer.getData("text");
    const span = document.createElement("div");
    span.className = "employee";
    span.textContent = data;
    e.target.appendChild(span);
}

function exportExcel() {
    fetch("/export-excel").then(r => r.blob()).then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "schedule.xlsx";
        a.click();
    });
}
</script>
</body>
</html>
